{% extends 'base.html' %}
{% block title %}{{ poll.title }}{% endblock %}
{% block content %}
    <h1 class="my-4">{{ poll.title }}</h1>
    {% if poll.description %}
        <p>{{ poll.description|linebreaks }}</p>
    {% endif %}
    <p class="text-muted">Створено: {{ poll.created_at|date:"d.m.Y H:i" }} | Автор: {{ poll.created_by.username }}</p>

    {% if user.is_authenticated %}
        {% if has_voted %}
            <div class="alert alert-info">
                Ви вже проголосували в цьому опитуванні.
            </div>
            <h5>Результати:</h5>
            <ul class="list-group mb-4">
                {% for option in poll.options.all %}
                    <li class="list-group-item">
                        {{ option.text }}: {{ option.vote_count }} голосів
                        <div class="progress mt-2">
                            <div class="progress-bar" role="progressbar" style="width: {% widthratio option.vote_count poll.votes.count 100 %}%;" aria-valuenow="{% widthratio option.vote_count poll.votes.count 100 %}" aria-valuemin="0" aria-valuemax="100">
                                {% widthratio option.vote_count poll.votes.count 100 %}%
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <h5>Проголосувати:</h5>
            <form method="post" action="{% url 'polls:poll_vote' poll.pk %}">
                {% csrf_token %}
                {% for option in poll.options.all %}
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="option" id="option{{ option.id }}" value="{{ option.id }}" required>
                        <label class="form-check-label" for="option{{ option.id }}">
                            {{ option.text }}
                        </label>
                    </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary">Проголосувати</button>
            </form>
        {% endif %}
    {% else %}
        <div class="alert alert-warning">
            <p>Будь ласка, <a href="{% url 'login' %}">увійдіть</a>, щоб проголосувати.</p>
        </div>
    {% endif %}
    <a href="{% url 'polls:poll_list' %}" class="btn btn-secondary mt-3">Назад до списку</a>
{% endblock %}